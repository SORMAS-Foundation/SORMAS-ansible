server {
    listen 80;
    server_name {{ domain_name }}; 
    return 301 https://$host$request_uri;
}
server {
    listen 80;
    listen 443 ssl;
    server_name *.{{ domain_name }};
    return 301 https://{{ domain_name }}$request_uri;
}

server {

    listen 443 ssl;
    server_name  {{ domain_name }};

    ssl_certificate           /etc/letsencrypt/live/{{ domain_name }}/fullchain.pem;
    ssl_certificate_key        /etc/letsencrypt/live/{{ domain_name }}/privkey.pem;


    proxy_hide_header X-Powered-By;

    proxy_cookie_domain ~(?P<secure_domain>([-0-9a-z]+\.)?[-0-9a-z]+\.[a-z]+)$ "$secure_domain; secure";

    add_header Public-Key-Pins 'pin-sha256="sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis="; pin-sha256="YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg="; pin-sha256="C5+lpZ7tcVwmwQIMcRtPbsQtWLABXhQzejna0wHFr8M=^C  max-age=60;';
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-XSS-Protection "1; mode=block";
    add_header Referrer-Policy no-referrer;
    add_header X-Content-Type-Options nosniff;

    
#    access_log  /config/log/nginx/access.log  main;
#    error_log   /config/log/nginx/error.log crit;

    location / {
       proxy_pass      https://apache2:443;
       proxy_ssl_verify              off;
       proxy_set_header Host            $host;
       proxy_set_header X-Forwarded-For $remote_addr;
    }
  }